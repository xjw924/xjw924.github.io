<!DOCTYPE html>
<html lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="xjw924">


    <meta name="subtitle" content="Hi, there~">


    <meta name="description" content="统计|数据分析|机器学习|大数据">



<title>Random Forest 随机森林 | 小徐小徐不断学习</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
            <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


        
    


<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">HOME</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">HOME</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Random Forest 随机森林</h1>
            
        </header>

        <div class="post-content">
            <h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h2><p>RF是Bagging算法的优化版本</p>
<p>其在以决策树为基学习器构建 Bagging 集成的基础上，进一步在决策树的训练过程中引入了随机属性选择。</p>
<p>实现过程：</p>
<ol>
<li>从样本集中用Bootstrap采样选出n个样本</li>
<li>从所有属性中随机选择k个属性，选择最佳分割属性作为节点建立CART决策树</li>
<li>重复1、2两个步骤，即建立了m棵CART决策树</li>
<li>m个CART形成随机森林，通过投票表决结果，决定数据属于哪一类</li>
</ol>
<h2 id="RF的节点划分"><a href="#RF的节点划分" class="headerlink" title="RF的节点划分"></a>RF的节点划分</h2><p>随机森林中的每一棵分类树为二叉树，<strong>从根节点开始依次对训练集进行划分</strong></p>
<p><strong>纯度度量方法是Gini准则</strong>，按照<strong>节点纯度最小原则</strong>，分裂为左节点和右节点，它们分别包含训练数据的一个子集，按照同样的规则节点继续分裂，直到满足分支停止规则而停止生长</p>
<p>若节点n上的分类数据全部来自于同一类别，则此节点的纯度$I(n)=0$</p>
<h2 id="RF的随机性体现"><a href="#RF的随机性体现" class="headerlink" title="RF的随机性体现"></a>RF的随机性体现</h2><ol>
<li><p>样本随机有放回采样（自助法重采样）</p>
<p>决策树对它们所训练的数据非常敏感，且对训练集的微小更改可以导致明显不同的树结构。随机森林利用了这一点，允许每棵单独的树从数据集中随机抽取样本，并进行替换，从而生成不同的树。这个过程被称为bagging。</p>
</li>
<li><p>随机属性选择<strong>（随机森林与普通bagging的区别）</strong></p>
<p>传统的决策树在选择划分属性时是在当前结点的属性集合中选择一个最优属性。</p>
<p>而在随机森林中，对子决策树的每个结点，先从该结点的属性集合中随机选择一个子集，然后再从这个子集中选择一个最优属性用于划分。 </p>
</li>
</ol>
<p>=&gt; 两个随机性的引入，使得随机森林不容易陷入过拟合 </p>
<h2 id="RF和Bagging对比"><a href="#RF和Bagging对比" class="headerlink" title="RF和Bagging对比"></a>RF和Bagging对比</h2><p>与 Bagging 中基学习器的多样性仅通过样本扰动(通过对初始训练集采样)而来不同</p>
<p>随机森林中基学习器的多样性不仅来自<strong>样本扰动</strong>，还来自<strong>属性扰动</strong></p>
<p>好处：</p>
<ol>
<li><p>最终集成的<strong>泛化性能</strong>可通过个体学习器之间差异度的增加而进一步提升。</p>
</li>
<li><p>随机森林的<strong>训练效率</strong>也会高于Bagging，因为在单个决策树的构建中，Bagging使用的是<strong>确定型</strong>决策树，在选择特征划分结点时，要对所有的特征进行考虑，而随机森林使用的是<strong>随机型</strong>决策树，只需考虑特征的子集。</p>
</li>
</ol>
<p>RF的起始性能较差，特别当只有一个基学习器时。但随着学习器数目增多，随机森林通常会收敛到更低的<strong>泛化误差</strong>。</p>
<h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><p>优点：</p>
<ol>
<li><p>训练可以高度并行化，对于大数据时代的大样本训练速度有优势（最主要的优点）</p>
</li>
<li><p>能够处理很高维的数据，并且不用特征选择，而且在训练完后，给出特征的重要性</p>
</li>
<li><p>相对于Boosting系列的Adaboost和GBDT，RF实现比较简单。</p>
</li>
</ol>
<p>缺点：在噪声较大的分类或者回归问题上容易过拟合。</p>
<h2 id="特征重要程度Feature-Importance"><a href="#特征重要程度Feature-Importance" class="headerlink" title="特征重要程度Feature Importance"></a>特征重要程度Feature Importance</h2><p><strong>特征在RF所有决策树中节点分裂不纯度的平均改变量</strong></p>
<ul>
<li>节点$m$的Gini指数计算公式：</li>
</ul>
<script type="math/tex; mode=display">
Gini_m=1-\sum_{k=1}^{|K|}p_{mk}^2</script><p>​        其中，$K$表示类别的总个数，$p_{mk}$表示节点m中类别$k$所占的比例</p>
<p>​        直观来说，是<strong>任意从节点$m$中随机抽取两个样本，其类别不一致的概率</strong></p>
<ul>
<li>特征$X_j$在节点$m$的重要性，即节点$m$分枝前后的Gini指数变化量为</li>
</ul>
<script type="math/tex; mode=display">
VIM_{jm}=Gini_m-Gini_l-Gini_r</script><p>​        其中，$Gini_l$和$Gini_r$分别表示分枝后两个新节点的Gini指数。</p>
<ul>
<li>特征$X_j$在第$i$颗树的重要性为</li>
</ul>
<script type="math/tex; mode=display">
VIM_{ij}=\sum_{m∈M}VIM_{jm}</script><ul>
<li>假设随机森林共有$n$颗树</li>
</ul>
<script type="math/tex; mode=display">
VIM_{j}=\sum_{i=1}^{n}VIM_{ij}</script><ul>
<li>最后将所有特征求得的重要性评分进行归一化，得到特征$X_j$的重要性</li>
</ul>
<script type="math/tex; mode=display">
VIM_{j}=\frac{VIM_{j}}{\sum_{i=1}^{n}VIM_{i}}</script><h2 id="LR-SVM-RF算法的区别"><a href="#LR-SVM-RF算法的区别" class="headerlink" title="LR/SVM/RF算法的区别"></a>LR/SVM/RF算法的区别</h2><p>都是监督学习算法，都是判别模型。</p>
<p>如果不考虑核函数，LR和SVM都是线性分类算法，也就是说他们的分类决策面都是线性的。</p>
<p>LR优点：</p>
<p>1.适合需要得到一个分类概率的场景</p>
<p>2.实现效率较高</p>
<p>3.对逻辑回归而言，多重共线性并不是问题，它可以结合L2正则化来解决；</p>
<p>4.逻辑回归广泛的应用于工业问题上</p>
<p>LR的缺点：</p>
<p>1.当特征空间很大时，逻辑回归的性能不是很好；</p>
<p>2.不能很好地处理大量多类特征或变量；</p>
<p>3.对于非线性特征，需要进行转换；</p>
<p>4.依赖于全部的数据特征，当特征有缺失的时候表现效果不好。</p>
<p>SVM的优点：</p>
<p>1.能够处理大型特征空间</p>
<p>2.能够处理非线性特征之间的相互作用</p>
<p>3.无需依赖整个数据</p>
<p>SVM的缺点：</p>
<p>1.当观测样本很多时，效率并不是很高</p>
<p>2.有时候很难找到一个合适的核函数</p>
<p>决策树的优点：</p>
<p>1.直观的决策规则</p>
<p>2.可以处理非线性特征</p>
<p>3.考虑了变量之间的相互作用</p>
<p>决策树的缺点：</p>
<p>1.训练集上的效果高度优于测试集，即过拟合[随机森林克服了此缺点]</p>
<p>2.没有将排名分数作为直接结果</p>
<p>如何选择三种模型：</p>
<p>首当其冲应该选择的就是逻辑回归，如果它的效果不怎么样，那么可以将它的结果作为基准来参考；</p>
<p>然后试试决策树（随机森林）是否可以大幅度提升模型性能。即使你并没有把它当做最终模型，你也可以使用随机森林来移除噪声变量；</p>
<p>如果特征的数量和观测样本特别多，那么当资源和时间充足时，使用SVM不失为一种选择。</p>
<h2 id="python调参"><a href="#python调参" class="headerlink" title="python调参"></a>python调参</h2><p><img src="file:///C:/WINDOWS/Temp/msohtmlclip1/01/clip_image004.png" alt="img"></p>
<h2 id="PySpark参数"><a href="#PySpark参数" class="headerlink" title="PySpark参数"></a>PySpark参数</h2><p>class pyspark.ml.classification.RandomForestClassifier(featuresCol=’features’, labelCol=’label’, predictionCol=’prediction’, probabilityCol=’probability’, rawPredictionCol=’rawPrediction’, <strong>maxDepth=5,</strong> maxBins=32, minInstancesPerNode=1, minInfoGain=0.0, maxMemoryInMB=256, cacheNodeIds=False, checkpointInterval=10, <strong>impurity=’gini’</strong>, <strong>numTrees=20</strong>, <strong>featureSubsetStrategy</strong>=’auto’, seed=None, subsamplingRate=1.0)[source]</p>

        </div>

        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/MachineLearning/"># MachineLearning</a>
                    
                        <a href="/tags/Ensemble/"># Ensemble</a>
                    
                        <a href="/tags/Classification/"># Classification</a>
                    
                        <a href="/tags/RandomForest/"># RandomForest</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2019/10/18/xgboost/">XGBoost</a>
            
            
            <a class="next" rel="next" href="/2019/10/18/tong-ji-si-kao/">统计思考</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© xjw924 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
